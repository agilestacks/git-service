---
version: 1
kind: component
meta:
  name: git-service
  brief: Git service
  source:
      dir: ../api

requires:
- kubernetes

parameters:
- name: component.ingress.fqdn
- name: component.ingress.protocol
- name: component.automation-hub.endpoint
- name: component.auth-service.endpoint
- name: component.git-service
  parameters:
  - name: name
    default: git
  - name: namespace
    default: automation-hub
    env:  NAMESPACE
  - name: image
    env:  IMAGE
  - name: gitApiSecret
    kind: user
  - name: hubApiSecret
    kind: user
  - name: authApiSecret
    kind: user
  - name: privatekey.base64Encoded
    kind: user
  - name: volume.size
    default: 100Gi
  - name: volume.path
    default: /mnt/nfs/gits/vol-00
  - name: bucket.region
    default: us-east-2
  - name: bucket.name
    default: agilestacks-distribution
- name: dns.domain
  brief: DNS domain
  kind: tech

templates:
  files: ["templates/*.template"]

outputs:
- name: component.git-service.endpoint
  brief: Git service API endpoint
  value: http://${component.git-service.name}.${component.git-service.namespace}.svc.cluster.local/api/v1
- name: component.git-service.ingressEndpoint
  brief: Git service ingress
  value: ${component.ingress.protocol}://${component.git-service.name}.${component.ingress.fqdn}
